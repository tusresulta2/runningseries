<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Inscritos Carrera AJE C√≥rdoba - La Carrera de las Empresas - 16 noviembre 2025</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="carrera, cordoba, aje, running, run" name="keywords">
    <meta content="5K, 10K en individual, parejas o equipos de 4. Ven a correr el 16 de Noviembre a la Carrera AJE C√≥rdoba en el Parque Miraflores con una espectacular llegada con la Mezquita-Catedral de fondo. 10K Prueba puntuable para el Circuito de Carreras Populares de C√≥rdoba." name="description">
    <meta property="og:image" content="https://runningseries.es/2024/preview.png">
    <meta property="og:title" content="Inscritos Carrera AJE C√≥rdoba - La Carrera de las Empresas - 16 noviembre 2025" />
    <meta property="og:description" content="5K, 10K en individual, parejas o equipos de 4. Ven a correr el 16 de Noviembre a la Carrera AJE C√≥rdoba en el Parque Miraflores con una espectacular llegada con la Mezquita-Catedral de fondo. 10K Prueba puntuable para el Circuito de Carreras Populares de C√≥rdoba." />

    <link href="img/favicon.ico" rel="icon">
    <style>
        /* Estilos CSS B√ÅSICOS */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #c9071d;
        }

        #search-container {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        /* --- B√öSQUEDA GENERAL --- */
        #general-search-group {
            margin-bottom: 20px;
        }
        #search-input {
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        #search-input:focus {
            border-color: #c9071d;
            outline: none;
        }

        /* --- ESTILOS DE FILTRO --- */
        #filters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: flex-end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
            flex-grow: 1;
        }

        .filter-group label {
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .filter-group select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-height: 40px;
        }

        /* Estilo para Multi-Select */
        .filter-group select[multiple] {
            height: 120px;
            border: 2px solid #c9071d;
        }

        /* ESTILOS DE BOTONES */
        .action-buttons {
            display: flex;
            gap: 10px;
            height: 40px;
            min-width: 150px;
            flex-grow: 1;
        }

        #apply-filter-btn, #reset-filter-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            flex-grow: 1;
            white-space: nowrap;
        }

        #apply-filter-btn {
            background-color: #c9071d;
            color: white;
        }

        #apply-filter-btn:hover {
            background-color: #a30616;
        }

        #reset-filter-btn {
            background-color: #f0ad4e;
            color: white;
        }

        #reset-filter-btn:hover {
            background-color: #ec971f;
        }

        /* ESTILO PARA EL CONTADOR */
        #record-count {
            margin-top: 10px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        #results-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: flex-start;
        }

        .card {
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-left: 5px solid #c9071d;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 320px;
            min-width: 300px;
            box-sizing: border-box;
        }

        .card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.2em;
        }

        .card p {
            margin: 5px 0;
            color: #666;
            line-height: 1.4;
        }

        .card p strong {
            color: #333;
            font-weight: 600;
        }

        .no-results {
            color: #d9534f;
            font-weight: bold;
            padding: 15px;
        }
    </style>
</head>
<body>

    <div id="search-container">
        <h1>üîç B√∫squeda de inscripciones SPG RunningSeries AJE C√≥rdoba 2025</h1>

        <div id="general-search-group">
            <input type="text" id="search-input" placeholder="B√∫squeda General por Nombre, Apellidos, Dorsal, Club, etc." disabled>
        </div>

        <div id="filters-container">

            <div class="filter-group">
                <label for="filter-carrera">Carrera</label>
                <select id="filter-carrera" multiple disabled>
                    <option value="" disabled>Cargando...</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-sexo">Sexo</label>
                <select id="filter-sexo" multiple disabled>
                    <option value="" disabled>Cargando...</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-modalidad">Modalidad</label>
                <select id="filter-modalidad" multiple disabled>
                    <option value="" disabled>Cargando...</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-club">Club</label>
                <select id="filter-club" multiple disabled>
                    <option value="" disabled>Cargando...</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-empresa">Empresa</label>
                <select id="filter-empresa" multiple disabled>
                    <option value="" disabled>Cargando...</option>
                </select>
            </div>

            <div class="action-buttons">
                <button id="apply-filter-btn" disabled>Aplicar Filtros</button>
                <button id="reset-filter-btn" disabled>Restablecer Filtros</button>
            </div>
        </div>
        <div id="record-count">Cargando datos...</div>
    </div>

    <div id="results-container">
    </div>
    <script>
        // üìù 1. Referencias a elementos del DOM
        const searchInput = document.getElementById('search-input');
        const resultsContainer = document.getElementById('results-container');
        const recordCount = document.getElementById('record-count');
        const applyFilterBtn = document.getElementById('apply-filter-btn');
        const resetFilterBtn = document.getElementById('reset-filter-btn');

        const filterCarrera = document.getElementById('filter-carrera');
        const filterSexo = document.getElementById('filter-sexo');
        const filterModalidad = document.getElementById('filter-modalidad');
        const filterClub = document.getElementById('filter-club');
        const filterEmpresa = document.getElementById('filter-empresa');

        // Columnas mapeadas a sus select IDs
        const FILTER_CONFIG = {
            'Carrera': filterCarrera,
            'Sexo': filterSexo,
            'Modalidad': filterModalidad,
            'Club': filterClub,
            'Nombre de la Empresa que representas:': filterEmpresa
        };

        // Variable global para almacenar los datos una vez cargados
        let ALL_RUNNERS_DATA = [];

        // üÜï FUNCI√ìN DE NORMALIZACI√ìN DE TEXTO
        /**
         * Limpia una cadena de texto para la b√∫squeda:
         * 1. Convierte a min√∫sculas.
         * 2. Elimina acentos (√± -> n, √© -> e).
         * 3. Elimina caracteres no alfanum√©ricos ni espacios (caracteres especiales, puntos, comas).
         * @param {string} text
         * @returns {string} Texto normalizado para b√∫squeda.
         */
        function normalizeText(text) {
            if (!text) return '';
            // 1. Normaliza y elimina diacr√≠ticos (acentos)
            return String(text)
                .toLowerCase()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "") // Elimina acentos/diacr√≠ticos
                .replace(/[^a-z0-9\s]/g, '')    // Elimina caracteres especiales (mantiene espacios y letras/n√∫meros)
                .trim();
        }


        // ‚öôÔ∏è 2. Funci√≥n de Extracci√≥n y Normalizaci√≥n (para filtros)
        function getUniqueValues(data, key) {
            const values = data.map(item => {
                // L√≥gica especial para Modalidad
                if (key === 'Modalidad') {
                    return item["Tipo inscripci√≥n"] ? item["Tipo inscripci√≥n"].replace('Inscripci√≥n ', '') : 'Otros';
                }

                // L√≥gica especial para Club y Empresa (manejar valores vac√≠os)
                let value = item[key];
                if (key === 'Club' || key === 'Nombre de la Empresa que representas:') {
                    value = value && value.trim() !== '' ? value : 'Sin especificar';
                }

                return String(value || '').trim();
            });

            const unique = [...new Set(values)];

            return unique.filter(v => v !== '').sort((a, b) => {
                if (a === 'Sin especificar') return 1;
                if (b === 'Sin especificar') return -1;
                return a.localeCompare(b);
            });
        }

        // ‚öôÔ∏è 3. Funci√≥n para poblar los selects con opciones
        function populateFilters() {
            for (const key in FILTER_CONFIG) {
                const selectElement = FILTER_CONFIG[key];
                const uniqueValues = getUniqueValues(ALL_RUNNERS_DATA, key);

                selectElement.innerHTML = '';

                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = `(${uniqueValues.length} Opciones disponibles)`;
                defaultOption.disabled = true;
                selectElement.appendChild(defaultOption);

                uniqueValues.forEach(value => {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = value;
                    selectElement.appendChild(option);
                });

                selectElement.disabled = false;
            }

            applyFilterBtn.disabled = false;
            resetFilterBtn.disabled = false;
            searchInput.disabled = false;
        }

        // ‚öôÔ∏è 4. Funci√≥n de Filtrado (Combinada: B√∫squeda de Texto + Multi-Select)
        function applyFilters() {
            let filteredData = ALL_RUNNERS_DATA;
            const activeSelectFilters = {};
            // Normalizar el texto de b√∫squeda del usuario una sola vez
            const normalizedQuery = normalizeText(searchInput.value);
            let isGeneralSearchActive = normalizedQuery !== '';

            // --- FASE 1: Aplicar Filtro de B√∫squeda General (Texto) ---
            if (isGeneralSearchActive) {
                filteredData = filteredData.filter(item => {
                    for (const key in item) {
                        if (item.hasOwnProperty(key)) {
                            const value = item[key];
                            // Normalizar el valor del JSON antes de comparar
                            const normalizedValue = normalizeText(value);

                            if (normalizedValue.includes(normalizedQuery)) {
                                return true;
                            }
                        }
                    }
                    return false;
                });
            }

            // --- FASE 2: Recoger Filtros Multi-Select ---
            for (const key in FILTER_CONFIG) {
                const selectElement = FILTER_CONFIG[key];
                const selectedValues = Array.from(selectElement.options)
                    .filter(option => option.selected)
                    .map(option => option.value);

                if (selectedValues.length > 0) {
                    activeSelectFilters[key] = selectedValues;
                }
            }

            // --- FASE 3: Aplicar Filtros Multi-Select sobre los resultados filtrados por texto ---
            if (Object.keys(activeSelectFilters).length > 0) {
                filteredData = filteredData.filter(item => {
                    let matchesAllCriteria = true;

                    for (const filterKey in activeSelectFilters) {
                        const selectedValues = activeSelectFilters[filterKey];

                        // Determinar el valor del elemento a comparar (con la l√≥gica de normalizaci√≥n de filtros)
                        let itemValue;
                        if (filterKey === 'Modalidad') {
                            itemValue = item["Tipo inscripci√≥n"] ? item["Tipo inscripci√≥n"].replace('Inscripci√≥n ', '') : 'Otros';
                        } else if (filterKey === 'Club' || filterKey === 'Nombre de la Empresa que representas:') {
                            itemValue = item[filterKey] && item[filterKey].trim() !== '' ? item[filterKey] : 'Sin especificar';
                        } else {
                            itemValue = String(item[filterKey] || '').trim();
                        }

                        // Los valores de los selects ya est√°n estandarizados/limpios, no necesitan la normalizaci√≥n completa
                        if (!selectedValues.includes(itemValue)) {
                            matchesAllCriteria = false;
                            break;
                        }
                    }

                    return matchesAllCriteria;
                });
            }

            // Si no hay filtros de texto NI de select, mostramos todos los datos
            if (!isGeneralSearchActive && Object.keys(activeSelectFilters).length === 0) {
                filteredData = ALL_RUNNERS_DATA;
            }

            renderResults(filteredData);
        }

        // 5. Funci√≥n para Restablecer Filtros
        function resetFilters() {
            // Restablecer la b√∫squeda general
            searchInput.value = '';

            // Restablecer los selects
            for (const key in FILTER_CONFIG) {
                const selectElement = FILTER_CONFIG[key];
                Array.from(selectElement.options).forEach(option => {
                    option.selected = false;
                });
            }

            // Aplicar filtros para mostrar todos los resultados
            applyFilters();
        }


        // 6. Funci√≥n para Renderizar los Resultados (Mantenida)
        function renderResults(data) {
            resultsContainer.innerHTML = '';
            const totalRecords = ALL_RUNNERS_DATA.length;
            const foundRecords = data.length;

            recordCount.textContent = `Mostrando ${foundRecords} de ${totalRecords} registros.`;

            if (data.length === 0) {
                resultsContainer.innerHTML = '<p class="no-results">No se encontraron resultados que coincidan con los filtros aplicados.</p>';
                return;
            }

            data.forEach(item => {
                const card = document.createElement('div');
                card.classList.add('card');

                const modalidad = item["Tipo inscripci√≥n"].replace('Inscripci√≥n ','');
                const clubName = item.Club && item.Club.trim() !== '' ? item.Club : 'Sin especificar';

                const year = new Date(item["Fecha Nacimiento"]);
                const yearText = isNaN(year.getFullYear()) ? 'N/A' : year.getFullYear();

                const sexo = item.Sexo === 'Hombre' ? 'M' : 'F';

                const team = item["Escoge el nombre que eleg√≠s como PAREJA"] && item["Escoge el nombre que eleg√≠s como PAREJA"].trim() != '' ? item["Escoge el nombre que eleg√≠s como PAREJA"] :
                    (item["Escoge el nombre que eleg√≠s como EQUIPO"] && item["Escoge el nombre que eleg√≠s como EQUIPO"].trim() != '' ? item["Escoge el nombre que eleg√≠s como EQUIPO"] : 'N/A')

                const empresaName = item["Nombre de la Empresa que representas:"] && item["Nombre de la Empresa que representas:"].trim() !== '' ? item["Nombre de la Empresa que representas:"] : 'Sin especificar';

                const cardContent = `
                    <h3>${item.Nombre} ${item.Apellidos}</h3>
                    <p><strong>Dorsal:</strong> <span style="font-weight: bold; color: #d9534f;">${item.Dorsal}</span></p>
                    <p><strong>Carrera:</strong> ${item.Carrera}</p>
                    <p><strong>Modalidad:</strong> ${modalidad}</p>
                    <p><strong>A√±o:</strong> ${yearText}</p>
                    <p><strong>Sexo:</strong> ${sexo}</p>
                    <p><strong>Team:</strong> ${team}</p>
                    <p><strong>Club:</strong> ${clubName}</p>
                    <p><strong>Empresa:</strong> ${empresaName}</p>
                `;

                card.innerHTML = cardContent;
                resultsContainer.appendChild(card);
            });
        }


        // 7. Funci√≥n para cargar el JSON y inicializar la aplicaci√≥n
        async function loadDataAndInit() {
            try {
                recordCount.textContent = 'Cargando datos...';

                const response = await fetch('inscritos.json');

                if (!response.ok) {
                    throw new Error(`Error ${response.status}: Archivo no encontrado o error en el servidor.`);
                }

                ALL_RUNNERS_DATA = await response.json();

                // 1. PUEBLA los select de filtros con los valores √∫nicos
                populateFilters();

                // 2. Inicializa la vista con todos los datos
                applyFilters();

                // 3. Asigna el event listener a los botones
                applyFilterBtn.addEventListener('click', applyFilters);
                resetFilterBtn.addEventListener('click', resetFilters);

                // 4. Asigna el event listener a la caja de b√∫squeda (para aplicar filtros autom√°ticamente)
                searchInput.addEventListener('input', applyFilters);

            } catch (error) {
                resultsContainer.innerHTML = '<p class="no-results">‚ùå Error al cargar los datos. Verifica que el archivo **inscritos.json** exista en la misma carpeta y que est√©s ejecutando la p√°gina en un servidor web.</p>';
                recordCount.textContent = '0 registros.';
                console.error('Error al iniciar la aplicaci√≥n:', error);
            }
        }

        // Inicia el proceso de carga
        loadDataAndInit();

    </script>
</body>
</html>